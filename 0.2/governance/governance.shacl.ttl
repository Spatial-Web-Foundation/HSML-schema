@prefix gov: <https://www.spatialwebfoundation.org/ns/hsml/governance#> .
@prefix core: <https://www.spatialwebfoundation.org/ns/hsml/core#> .
@prefix act: <https://www.spatialwebfoundation.org/ns/hsml/activity#> .
@prefix agt: <https://www.spatialwebfoundation.org/ns/hsml/agent#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <http://schema.org/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# #################################################################
#
#    SHACL Shapes for HSML Governance Module
#
#    This file provides normative shapes for validating instances of
#    the Governance Module, focusing on the gov:Contract class, as
#    defined in the HSML Implementation Specification (P2874.X/D1,
#    May 2024).
#
# #################################################################

# #################################################################
#    Shape for gov:Contract
# #################################################################

gov:ContractShape
    a sh:NodeShape ;
    sh:targetClass gov:Contract ;
    sh:closed true ;
    sh:ignoredProperties ( rdf:type ) ;
    rdfs:label "Contract Shape" ;
    rdfs:comment "Defines the constraints for a gov:Contract. It inherits base properties from core:Entity." ;

    # == Inherited properties from core:Entity ==
    sh:property [
        sh:path core:swid ;
        sh:name "swid" ;
        sh:description "The Spatial Web Identifier for the contract." ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:datatype xsd:anyURI ;
        sh:message "A gov:Contract must have exactly one core:swid, and its value must be a valid URI."@en ;
    ] ;
    sh:property [
        sh:path schema:name ;
        sh:name "name" ;
        sh:description "A short, human-readable name for the contract." ;
        sh:maxCount 1 ;
        sh:datatype xsd:string ;
        sh:message "A gov:Contract can have at most one schema:name, which must be a string."@en ;
    ] ;
    sh:property [
        sh:path schema:description ;
        sh:name "description" ;
        sh:description "A detailed explanation of the contract's purpose." ;
        sh:maxCount 1 ;
        sh:datatype xsd:string ;
        sh:message "A gov:Contract can have at most one schema:description, which must be a string."@en ;
    ] ;

    # == Mandatory properties for gov:Contract ==
    sh:property [
        sh:path gov:isRequestedBy ;
        sh:name "isRequestedBy" ;
        sh:description "The core:Domain that initiated the contract." ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:class core:Domain ;
        sh:message "A gov:Contract must be requested by exactly one core:Domain."@en ;
    ] ;
    sh:property [
        sh:path gov:isAcceptedBy ;
        sh:name "isAcceptedBy" ;
        sh:description "The agt:Agent(s) that accepted the contract." ;
        sh:minCount 1 ;
        sh:class agt:Agent ;
        sh:message "A gov:Contract must be accepted by at least one agt:Agent."@en ;
    ] ;
    sh:property [
        sh:path gov:isFulfilledBy ;
        sh:name "isFulfilledBy" ;
        sh:description "The agt:Agent(s) responsible for fulfilling the contract." ;
        sh:minCount 1 ;
        sh:class agt:Agent ;
        sh:message "A gov:Contract must be fulfilled by at least one agt:Agent."@en ;
    ] ;
    sh:property [
        sh:path gov:contractFor ;
        sh:name "contractFor" ;
        sh:description "The act:Activity the contract governs." ;
        sh:minCount 1 ;
        sh:class act:Activity ;
        sh:message "A gov:Contract must govern at least one act:Activity."@en ;
    ] ;
    sh:property [
        sh:path gov:contractStatus ;
        sh:name "contractStatus" ;
        sh:description "The current lifecycle status of the contract." ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:datatype xsd:string ;
        sh:in ( "Requested" "Executed" "Fulfilled" "Rescinded" "Breached" ) ;
        sh:message "A gov:Contract must have exactly one status, which must be one of 'Requested', 'Executed', 'Fulfilled', 'Rescinded', or 'Breached'."@en ;
    ] ;

    # == Optional property for gov:Contract ==
    sh:property [
        sh:path gov:hasParticipation ;
        sh:name "hasParticipation" ;
        sh:description "Links to detailed participation records." ;
        sh:class core:Participation ;
        sh:message "Values for gov:hasParticipation must be instances of core:Participation."@en ;
    ] .